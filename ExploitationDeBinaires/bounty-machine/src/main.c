#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <stdbool.h>
#include <stdint.h>
#include <string.h>

void menu(void) {
    puts("╔╗ ┌─┐┬ ┬┌┐┌┌┬┐┬ ┬  ╔╦╗┌─┐┌─┐┬ ┬┬┌┐┌┌─┐");
    puts("╠╩╗│ ││ ││││ │ └┬┘  ║║║├─┤│  ├─┤││││├┤ ");
    puts("╚═╝└─┘└─┘┘└┘ ┴  ┴   ╩ ╩┴ ┴└─┘┴ ┴┴┘└┘└─┘");
    puts("---------------------------------------");
    puts("1. See the bounties                    ");
    puts("2. Add a bounty                        ");
    puts("3. Edit a bounty                       ");
    puts("4. Claim the latest bounty             ");
    puts("5. Exit                                ");
}

void exit_screen(void) {
    puts("⣿⣿⡿⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠐ ");
    puts("⣿⣿⡖⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣧⡀⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠀⣠⣴⣿ ");
    puts("⣿⡋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣤⠀⠀⢀⣀⠀⢀⡄⣠⠀⢠⣿⣷⣿⣦⣈⢢⣀⠢⣤⣤⣶⣤⣄⣀⣠⡀⠀⢀⣻⣿⣿⣿⣿⣿⣿ ");
    puts("⣉⣀⡀⠀⠀⠀⠀⠀⠀⠀⡄⢀⣾⣿⣿⣶⣿⣿⣿⣿⣿⣿⢃⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿ ");
    puts("⣿⣿⣤⣀⠀⠀⠀⢀⡀⢰⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣯⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿ ");
    puts("⣿⣿⣿⣿⡥⠂⢠⣤⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿ ");
    puts("⣿⣿⣿⣿⣷⣲⣿⣿⣿⣿⣿⣿⡇⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⠙⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿ ");
    puts("⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡈⢻⣿⣿⡋⠻⣧⣼⣿⣿⣿⣄⠀⢴⡿⡿⡿⢿⣿⣿⣿⣿⠀⠛⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿ ");
    puts("⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⣿⡟⠉⠉⠙⠛⠋⠥⠂⢰⠀⠀⠀⠀⠉⠒⠛⠻⣿⣿⠃⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿ ");
    puts("⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⠀⠀⠀⢣⢀⠀⠀⠀⡇⠀⠀⠀⠀⠀⠀⠀⢹⣿⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿ ");
    puts("⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣿⣿⣿⣿⠉⠙⠢⠀⠀⢰⠃⠀⠀⠀⣧⠀⠀⠀⠀⠀⠀⠀⢸⣿⡆⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣿⣿⣿ ");
    puts("⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⣀⢤⣾⠀⠀⠀⣷⣄⡦⡀⠀⠀⢠⣿⠀⠀⠀⠀⠀⠀⠀⣾⠀⢳⣼⣿⣿⡿⠀⠙⠿⣿⡿⠋⠀⠈⠙⢿ ");
    puts("⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡧⠊⠀⠈⠃⠀⠀⢠⣿⡟⠀⠈⣦⠀⠘⢿⡀⠀⠀⠀⠀⠀⠀⢇⠀⣿⣿⣿⣿⠁⠀⠀⠀⠈⠢⡀⠀⠀⠀⠀ ");
    puts("⣿⣿⡿⠿⠟⠛⠋⠉⣉⡠⠃⠀⣀⣀⣀⣠⣴⣿⣿⡆⢀⣼⡟⠀⠀⠀⠀⠀⠀⣀⡠⠔⠀⠸⣰⣿⣿⣿⠃⠀⠀⠀⠀⠀⠀⠈⠑⢄⠀⠀ ");
    puts("⠁⠀⠀⠀⠀⠀⠀⠹⡇⠀⠀⠀⠀⠀⠀⠉⠉⠉⠛⠧⢿⣿⣷⣄⠀⠀⣀⣀⣁⣀⡤⠀⠀⣼⣿⣿⣿⡏⠀⠀⠀⠀⠀⠀⠀⠀⣠⡟⠀⠀ ");
    puts("⠀⠀⠀⠀⠀⠀⠀⠀⢱⠀⠀⢀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠛⢧⡀⠈⠉⠉⠉⠀⠀⢰⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⢀⣤⣾⠟⠁⠀⠀ ");
    puts("⠀⠀⠀⠀⠀⠀⢄⣠⡇⠀⠀⠀⠀⠉⠑⠒⠠⠤⠤⣀⠀⠀⣰⣶⣦⣈⠢⠀⠀⠀⠀⣠⣿⣿⣿⣿⠟⠀⠀⠀⠀⣠⣶⣿⠟⠁⠀⠀⠀⠀ ");
    puts("⣶⣶⣤⣄⣀⠀⠀⠈⢻⣦⣀⣀⡀⠀⠀⠀⠀⠀⣤⣴⣿⣿⣿⣿⣿⣿⣿⣷⣤⣶⣿⣿⣿⣿⣿⠏⠀⢀⣠⣴⣾⣿⠟⠁⠀⠀⠀⠀⠀⠀ ");
    puts("⣀⣈⡉⣙⣿⣷⣤⠂⢸⣿⣿⣿⠿⠿⠷⢶⣦⣤⣿⣿⣿⣿⣿⣿⣿⢿⣿⣿⣿⣿⣿⣿⣿⡟⠁⣠⣾⣿⣿⣿⣿⡟⠀⠀⠀⠀⠀⠀⠀⣠ ");
    puts("⠋⠁⠀⣀⡽⡏⡈⠀⢻⣿⣿⣿⣿⣦⣄⣀⠀⠉⣉⣻⣿⣿⣿⠋⠁⠈⣿⣿⣿⣿⣿⣿⡏⠀⢠⣿⣿⣿⣿⢿⣿⡇⠀⠀⠀⠀⠀⢀⣴⣿ ");
    puts("⣠⣶⠟⠁⢠⠁⠃⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢻⣿⢻⣿⣿⠂⠀⠙⢿⣿⣿⣿⡿⠀⠀⢸⣿⣿⣿⡿⠀⢿⣷⠀⠀⠀⠀⢠⣾⣿⣿ ");
    puts("⡟⠁⠀⠀⡜⠀⠀⢠⠀⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣼⣿⡄⢿⣷⣤⣀⠐⢿⣿⣿⡿⠁⢀⣀⣼⠟⢹⣿⣿⠀⠘⣿⡆⠀⠀⠀⠈⠻⣿⣿ ");
    puts("⠀⠀⠀⠀⠇⠀⡆⠈⢦⠀⠙⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠃⠀⠙⢿⣿⡟⢶⣼⡟⡴⠛⣿⡟⠁⠀⢸⣿⡿⣧⠀⢻⣷⠀⠀⠀⠀⠀⠈⠛ ");
    puts("⠀⠀⠀⠀⠀⠀⢱⡀⠀⢳⣄⠈⢻⣿⣿⣿⣿⣿⣿⣿⡏⡆⠀⠀⠀⠙⢿⣄⠛⠙⠁⡼⠋⠀⠀⠀⣼⣿⡇⠹⣧⣸⣿⡆⠀⠀⠀⠀⠀⠀ ");
    puts("⠀⠀⠀⠀⠀⠀⠀⢷⣤⣴⣿⣷⣦⣹⣿⣿⣿⣿⣿⣿⣾⣿⠀⠀⠀⠀⠀⢻⠀⠀⠀⠀⠀⠀⠀⣼⠃⣾⣿⠀⠀⠉⢻⣧⠀⠀⠀⠀⠀⠀ ");
    puts("╔═╗┌─┐┌─┐  ┬ ┬┌─┐┬ ┬  ┌─┐┌─┐┌─┐┌─┐┌─┐  ┌─┐┌─┐┬ ┬  ┌┐ ┌─┐┬ ┬");
    puts("╚═╗├┤ ├┤   └┬┘│ ││ │  └─┐├─┘├─┤│  ├┤   │  │ ││││  ├┴┐│ │└┬┘");
    puts("╚═╝└─┘└─┘   ┴ └─┘└─┘  └─┘┴  ┴ ┴└─┘└─┘  └─┘└─┘└┴┘  └─┘└─┘ ┴ ");
}

struct bounty {
    int amount;
    char* name;
    char* description;
};

struct bounty *bounties[256];
uint8_t nbounties = 0;

void see_bounties() {
    for (int i = 0; i < nbounties; i++) {
        printf("----------------\n");
        printf("%d. %s : %d ￦\n", i + 1, bounties[i]->name, bounties[i]->amount);
        printf("%s\n", bounties[i]->description);
    }
}

void add_bounty() {
    struct bounty *new_bounty = malloc(sizeof(struct bounty));

    printf("Choose the bounty amount >> ");
    scanf("%d", &new_bounty->amount);
    getchar();

    printf("Who is about to be hunted ? >> ");
    char name[0x100];
    size_t name_len = read(0, name, 0x100);
    name[name_len - 1] = '\0';
    new_bounty->name = malloc(name_len);
    strcpy(new_bounty->name, name);

    printf("Tell me more about them >> ");
    char description[0x1000];
    size_t description_len = read(0, description, 0x1000);
    description[description_len - 1] = '\0';
    new_bounty->description = malloc(description_len);
    strcpy(new_bounty->description, description);

    bounties[nbounties] = new_bounty;

    nbounties += 1;
}

void edit_bounty(uint8_t i) {
    printf("You are currently modifying the following bounty : \n");
    printf("%d. %s : %d ￦\n", i + 1, bounties[i]->name, bounties[i]->amount);
    printf("%s\n", bounties[i]->description);

    printf("Choose the new amount >> ");
    scanf("%d", &bounties[i]->amount);
    getchar();

    printf("Edit the description >> ");
    char description[0x1000];
    size_t description_len = read(0, description, 0x1000);
    description[description_len - 1] = '\0';
    realloc(bounties[i]->description, description_len);
    strcpy(bounties[i]->description, description);
}

void claim_bounty() {
    nbounties -= 1;
    
    printf("Congratulations for your catch of %s ! Your money will be transfered soon...\n", bounties[nbounties]->name);
    free(bounties[nbounties]->name);
    free(bounties[nbounties]->description);
    free(bounties[nbounties]);
}


int main(void) {
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);
    setvbuf(stderr, NULL, _IONBF, 0);
    long long choice;
    int idx;
    int res;

    while (true) {
        menu();
        printf("Enter your choice\n> ");
        res = scanf("%lld", &choice);
        getchar();
        if (!res) exit(EXIT_FAILURE);

        switch (choice) {
            case 1:
                if (nbounties != 0) {
                    see_bounties();
                } else {
                    puts("No bounties, yet...");
                }
                break;
            case 2:
                add_bounty();
                break;
            case 3:
                printf("Choose the bounty to edit\n>> ");
                res = scanf("%d", &idx);
                getchar();
                if (idx < nbounties) {
                    edit_bounty(idx);
                } else {
                    puts("This bounty doesn't exist");
                }
                if (!res) exit(EXIT_FAILURE);
                break;
            case 4:
                claim_bounty();
                break;
            case 5:
                exit_screen();
                exit(EXIT_SUCCESS);
            default:
                puts("Invalid!!!");
                exit(choice);
        }
    }
    return 0;
}
